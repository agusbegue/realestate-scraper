
{% extends "main/base.html" %}

{% block title %}Scraper Home{% endblock %}

{% block content %}

<link href="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/css/select2.min.css" rel="stylesheet" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/js/select2.min.js"></script>

<div>
    {% if error_message %}<p style="color:red"><strong>{{ error_message }}</strong></p>{% endif %}

    <form action="{% url 'crawl' %}" method="post">
    {% csrf_token %}
        <div>
            {% for categoria in categorias %}
                <input type="radio" name="categoria" id="categoria{{ forloop.counter}}" value="{{categoria}}">
                <label for="categoria{{ forloop.counter}}">{{ categoria }}</label><br>
            {% endfor %}
        </div>
        <br>
        <div>
            <label for="lugar">Ubicacion</label><br>
            <select id="lugar" name="lugar"> </select>
        </div>
        <br>
    <input type="submit" value="Crawl">
    </form>

    <script type="text/javascript">
      $(document).ready(function(){
          $.ajax({
            url:'http://localhost:8080/lugares',
            dataType: 'json',
            success: function(data){
              var $selectLugar = $('#lugar');
              $(data).each(function(pos, elem){
              var $option = $('<option value="'+elem.text+'">'+elem.text+'</option>')
                $selectLugar.append($option);
              });
            }
          });
          $('#lugar').select2({
            width:'20%',
        });
      });
    </script>
</div>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/2.0.7/daterangepicker.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.8/css/jquery.dataTables.min.css">
<script type="text/javascript" charset="utf8" src="//code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/2.0.7/daterangepicker.js"></script>

<div class="container">
    <div class="row">
        <div class="col-sm-4">
              <table class="datatable">
                    <thead>
                        <th>ID</th>
                        <th>Scraped url</th>
                        <th>Details</th>
                        <th>Status</th>
                    </thead>
                    <tbody>
                    </tbody>
              </table><br><br>
        </div>
    </div>
    <script>
    $(document).ready(function() {
      var oTable = $('.datatable').dataTable({
        "processing": true,
        "serverSide": true,
        "ajax": "{% url 'order_list_json' %}"
      });
    });
    </script>
    <form action="{% url 'home' %}" method='post'>
        {% csrf_token %}
        <button type='submit' name='delete_jobs'>BORRAR TODO</button>
    </form>
</div>

{% endblock %}